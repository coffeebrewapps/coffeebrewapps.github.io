<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link rel="stylesheet" href="/assets/css/styles.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="me" href="https://mastodon.social/@geekhoon">
    <link rel="me" href="https://mastodon.hackerdrinks.social/@geekhoon">
    <title>Shots</title>
  </head>
  <body>
    <script src="/assets/js/main.js"></script>
    <nav id="top-nav" class="top-nav">
  
    <a href="/" >
      Home
    </a>
  
    <a href="/about.html" >
      About
    </a>
  
    <a href="/articles.html" >
      Articles
    </a>
  
    <a href="/series.html" >
      Series
    </a>
  
    <a href="/projects.html" >
      Projects
    </a>
  
    <a href="/shots.html" class="current">
      Shots
    </a>
  
    <a href="/archives.html" >
      Archives
    </a>
  
  <a href="javascript:void(0);" class="icon" onclick="toggleMenu()">
    <i class="fa-solid fa-bars"></i>
  </a>
</nav>

    <div class="container">
      <h1>Shots</h1>
<p>Mid-day shots to boost your energy.</p>
<div class="collapsible">
  
    <div class="item" id="ruby3-rails7-upgrade-section">
      <div class="title">
        <span>Ruby3 + Rails7 Upgrade</span>
        <small>Feb 02, 2024 <em>by gohkhoonhiang</em></small>
      </div>
      <div class="preview" id="ruby3-rails7-upgrade-preview">
        <p><p>Recently I just completed Ruby2-&gt;Ruby3 + Rails6-&gt;Rails7 upgrade for my private project. Initially I thought it would
take a lot of fixing to make it work, but was surprised it only impacted 17 out of the 88 Ruby files out of the <code class="language-plaintext highlighter-rouge">app/</code>
directory. Since it was a relatively simple fix, I decided to just write a shot instead of a long article to document
my changes.</p>
</p>
      </div>
      <div class="full-content" id="ruby3-rails7-upgrade-content" hidden>
        <p>Recently I just completed Ruby2-&gt;Ruby3 + Rails6-&gt;Rails7 upgrade for my private project. Initially I thought it would
take a lot of fixing to make it work, but was surprised it only impacted 17 out of the 88 Ruby files out of the <code class="language-plaintext highlighter-rouge">app/</code>
directory. Since it was a relatively simple fix, I decided to just write a shot instead of a long article to document
my changes.</p>

<p>I have 27 gems before the upgrade. In order to use Rails7, I had to deprecate <code class="language-plaintext highlighter-rouge">webpacker</code> and add the replacement gems:</p>

<figure class="highlight">
  <pre><code class="language-ruby" data-lang="ruby"><span class="n">gem</span> <span class="s1">'sassc-rails'</span><span class="p">,</span> <span class="s1">'~&gt; 2.0'</span>
<span class="n">gem</span> <span class="s1">'jsbundling-rails'</span><span class="p">,</span> <span class="s1">'~&gt; 1.0'</span>
<span class="n">gem</span> <span class="s1">'cssbundling-rails'</span>
<span class="n">gem</span> <span class="s1">'sass-embedded'</span>
<span class="n">gem</span> <span class="s1">'sprockets'</span><span class="p">,</span> <span class="s1">'~&gt; 4.0'</span></code></pre>
</figure>

<p>This also removed a few JS packages related to webpacker:</p>

<figure class="highlight">
  <pre><code class="language-js" data-lang="js"><span class="dl">"</span><span class="s2">@rails/webpacker</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">5.4.3</span><span class="dl">"</span><span class="p">,</span>
<span class="dl">"</span><span class="s2">webpack-dev-server</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">^4.9.2</span><span class="dl">"</span></code></pre>
</figure>

<p>While adding new ones to replace the missing webpacker package:</p>

<figure class="highlight">
  <pre><code class="language-js" data-lang="js"><span class="dl">"</span><span class="s2">@babel/core</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">^7.22.10</span><span class="dl">"</span><span class="p">,</span>
<span class="dl">"</span><span class="s2">@babel/plugin-proposal-class-properties</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">^7.18.6</span><span class="dl">"</span><span class="p">,</span>
<span class="dl">"</span><span class="s2">@babel/plugin-proposal-object-rest-spread</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">^7.20.7</span><span class="dl">"</span><span class="p">,</span>
<span class="dl">"</span><span class="s2">@babel/plugin-syntax-dynamic-import</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">^7.8.3</span><span class="dl">"</span><span class="p">,</span>
<span class="dl">"</span><span class="s2">@babel/plugin-transform-destructuring</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">^7.22.10</span><span class="dl">"</span><span class="p">,</span>
<span class="dl">"</span><span class="s2">@babel/plugin-transform-regenerator</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">^7.22.10</span><span class="dl">"</span><span class="p">,</span>
<span class="dl">"</span><span class="s2">@babel/plugin-transform-runtime</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">^7.22.10</span><span class="dl">"</span><span class="p">,</span>
<span class="dl">"</span><span class="s2">@babel/preset-env</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">^7.22.10</span><span class="dl">"</span><span class="p">,</span>
<span class="dl">"</span><span class="s2">babel-loader</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">^9.1.3</span><span class="dl">"</span><span class="p">,</span>
<span class="dl">"</span><span class="s2">babel-plugin-macros</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">^3.1.0</span><span class="dl">"</span><span class="p">,</span>
<span class="dl">"</span><span class="s2">css-loader</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">^6.8.1</span><span class="dl">"</span><span class="p">,</span>
<span class="dl">"</span><span class="s2">vue-style-loader</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">^4.1.3</span><span class="dl">"</span><span class="p">,</span>
<span class="dl">"</span><span class="s2">webpack</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">^5.88.2</span><span class="dl">"</span><span class="p">,</span>
<span class="dl">"</span><span class="s2">webpack-cli</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">^5.1.4</span><span class="dl">"</span></code></pre>
</figure>

<p>Then, I added a new webpack config file in order to compile my Vue2 assets:</p>

<figure class="highlight">
  <pre><code class="language-js" data-lang="js"><span class="kd">const</span> <span class="nx">path</span>    <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">path</span><span class="dl">"</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">webpack</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">webpack</span><span class="dl">"</span><span class="p">)</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">VueLoaderPlugin</span> <span class="p">}</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">vue-loader</span><span class="dl">"</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">mode</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_ENV</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">development</span><span class="dl">'</span> <span class="p">?</span> <span class="dl">'</span><span class="s1">development</span><span class="dl">'</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">production</span><span class="dl">'</span>

<span class="c1">// Reference: https://vue-loader.vuejs.org/guide/#vue-cli</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">mode</span><span class="p">,</span>
  <span class="na">module</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">rules</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="na">test</span><span class="p">:</span> <span class="sr">/</span><span class="se">\.</span><span class="sr">vue$/</span><span class="p">,</span>
        <span class="na">loader</span><span class="p">:</span> <span class="dl">"</span><span class="s2">vue-loader</span><span class="dl">"</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="na">test</span><span class="p">:</span> <span class="sr">/</span><span class="se">\.</span><span class="sr">js$/</span><span class="p">,</span>
        <span class="na">exclude</span><span class="p">:</span> <span class="sr">/node_modules/</span><span class="p">,</span>
        <span class="na">loader</span><span class="p">:</span> <span class="dl">'</span><span class="s1">babel-loader</span><span class="dl">'</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="na">test</span><span class="p">:</span> <span class="sr">/</span><span class="se">\.</span><span class="sr">css$/</span><span class="p">,</span>
        <span class="na">use</span><span class="p">:</span> <span class="p">[</span>
          <span class="dl">'</span><span class="s1">vue-style-loader</span><span class="dl">'</span><span class="p">,</span>
          <span class="dl">'</span><span class="s1">css-loader</span><span class="dl">'</span>
        <span class="p">]</span>
      <span class="p">}</span>
    <span class="p">]</span>
  <span class="p">},</span>
  <span class="na">entry</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">application</span><span class="p">:</span> <span class="dl">"</span><span class="s2">./app/javascript/application.js</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">index</span><span class="p">:</span> <span class="dl">"</span><span class="s2">./app/javascript/packs/dashboard/index.js</span><span class="dl">"</span>
  <span class="p">},</span>
  <span class="na">output</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">filename</span><span class="p">:</span> <span class="dl">"</span><span class="s2">[name].js</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">sourceMapFilename</span><span class="p">:</span> <span class="dl">"</span><span class="s2">[file].map</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">path</span><span class="p">:</span> <span class="nx">path</span><span class="p">.</span><span class="nf">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="dl">"</span><span class="s2">..</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">..</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">app/assets/builds</span><span class="dl">"</span><span class="p">),</span>
  <span class="p">},</span>
  <span class="na">plugins</span><span class="p">:</span> <span class="p">[</span>
    <span class="k">new</span> <span class="nx">webpack</span><span class="p">.</span><span class="nx">optimize</span><span class="p">.</span><span class="nc">LimitChunkCountPlugin</span><span class="p">({</span>
      <span class="na">maxChunks</span><span class="p">:</span> <span class="mi">1</span>
    <span class="p">}),</span>
    <span class="k">new</span> <span class="nc">VueLoaderPlugin</span><span class="p">()</span>
  <span class="p">],</span>
  <span class="na">optimization</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">moduleIds</span><span class="p">:</span> <span class="dl">"</span><span class="s2">deterministic</span><span class="dl">"</span>
  <span class="p">}</span>
<span class="p">}</span>
 </code></pre>
</figure>

<p>Finally, I added new scripts in <code class="language-plaintext highlighter-rouge">package.json</code> to allow me to build my assets:</p>

<figure class="highlight">
  <pre><code class="language-json" data-lang="json"><span class="nl">"scripts"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nl">"build"</span><span class="p">:</span><span class="w"> </span><span class="s2">"webpack --config config/webpack/webpack.config.js"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"build:css"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sass ./app/assets/stylesheets/application.scss:./app/assets/builds/application.css --no-source-map --load-path=node_modules"</span><span class="w">
</span><span class="p">}</span></code></pre>
</figure>

<p>That’s about all the configuration changes for the Rails7 upgrade.</p>

<p>Next there’re some syntax and API changes due to Ruby3 and Rails7. The list is non-exhaustive, because I might not
have used many features that are impacted by the upgrade. I also omitted the ones where there’s deprecation warning
and documented fix for it.</p>

<h4 id="serializable-hash">Serializable hash</h4>

<p>Previously, I could use <code class="language-plaintext highlighter-rouge">ActiveRecord#serializable_hash</code> without any arguments and it will serialize additional
instance methods in the AR. For example, I have a <code class="language-plaintext highlighter-rouge">User</code> with a <code class="language-plaintext highlighter-rouge">#avatar</code> method:</p>

<figure class="highlight">
  <pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="k">def</span> <span class="nf">avatar</span>
    <span class="s2">"http://www.gravatar.com/avatar/</span><span class="si">#{</span><span class="no">Digest</span><span class="o">::</span><span class="no">MD5</span><span class="p">.</span><span class="nf">hexdigest</span><span class="p">(</span><span class="n">email</span><span class="p">)</span><span class="si">}</span><span class="s2">?s=30"</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>
</figure>

<p>I used to be able to serialize by invoking <code class="language-plaintext highlighter-rouge">user.serializable_hash</code>. In Rails7, I had to explicitly pass in the
<code class="language-plaintext highlighter-rouge">methods</code> argument: <code class="language-plaintext highlighter-rouge">user.serializable_hash(methods: %i(avatar))</code>.</p>

<h4 id="csrf-token-verification">CSRF token verification</h4>

<p>Previously, these lines of code worked.</p>

<figure class="highlight">
  <pre><code class="language-ruby" data-lang="ruby"><span class="n">protect_from_forgery</span> <span class="ss">with: :exception</span><span class="p">,</span> <span class="ss">unless: </span><span class="o">-&gt;</span> <span class="p">{</span> <span class="n">request</span><span class="p">.</span><span class="nf">format</span><span class="p">.</span><span class="nf">json?</span> <span class="p">}</span>

<span class="n">before_action</span> <span class="ss">:authenticate_user!</span></code></pre>
</figure>

<p>In Rails7, I have to add the <code class="language-plaintext highlighter-rouge">prepend: true</code> argument to <code class="language-plaintext highlighter-rouge">protect_from_forgery</code>, so that it will prepend this method
to the <code class="language-plaintext highlighter-rouge">before_action</code> chain.</p>

<p>The thing I haven’t figured out is why it didn’t work without <code class="language-plaintext highlighter-rouge">prepend: true</code>, even though I have declared
<code class="language-plaintext highlighter-rouge">protect_from_forgery</code> before <code class="language-plaintext highlighter-rouge">authenticate_user!</code>.</p>

<p><a href="https://github.com/heartcombo/devise#controller-filters-and-helpers" target="_blank" style="text-decoration: underline;">This is the Github README of the devise gem</a>
explaining the problem above.</p>

<p>That’s about all the changes I had to make. I’m still observing if anything else is broken, if there’s something new,
I will update this post again. Happy upgrading!</p>

      </div>
      <div class="btn"><a id="ruby3-rails7-upgrade-btn" href="#" onclick="toggleCollapse(this)">Expand</a></div>
    </div>
  
    <div class="item" id="bidirection_progress_bar-section">
      <div class="title">
        <span>Building a bi-directional progress bar</span>
        <small>May 04, 2023 <em>by gohkhoonhiang</em></small>
      </div>
      <div class="preview" id="bidirection_progress_bar-preview">
        <p><p>I needed to build a bi-directional indefinite progress bar for the Triple Tee App.</p>
</p>
      </div>
      <div class="full-content" id="bidirection_progress_bar-content" hidden>
        <p>I needed to build a bi-directional indefinite progress bar for the Triple Tee App.</p>

<p>I found some tutorial on how to build a static uni-directional one on
<a href="https://www.w3schools.com/w3css/tryit.asp?filename=tryw3css_progressbar_js" target="_blank">W3 Schools</a>, so
I improvised and tried to built one that is bi-directional and runs indefinitely like this:</p>

<div id="progress-bar" class="progress-bar">
  <div id="forward-bar" class="bar forward-bar" style="width: 0%;"></div>
  <div id="reverse-bar" class="bar reverse-bar" style="width: 100%;"></div>
</div>

<p>(This progress bar is running in real-time, click <a href="#" onclick="stopBar()">here</a> to stop the bar)</p>

<p>The idea I had was to use 2 <code class="language-plaintext highlighter-rouge">&lt;div&gt;</code>s, 1 growing towards the right side, and the other growing towards the left side.
Let’s call them the <code class="language-plaintext highlighter-rouge">forward-bar</code> and <code class="language-plaintext highlighter-rouge">reverse-bar</code> respectively.</p>

<figure class="highlight">
  <pre><code class="language-html" data-lang="html"><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"progress-bar"</span> <span class="na">class=</span><span class="s">"progress-bar"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"forward-bar"</span> <span class="na">class=</span><span class="s">"bar forward-bar"</span> <span class="na">style=</span><span class="s">"width: 0%;"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"reverse-bar"</span> <span class="na">class=</span><span class="s">"bar reverse-bar"</span> <span class="na">style=</span><span class="s">"width: 100%;"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span></code></pre>
</figure>

<p>At the initial state, the <code class="language-plaintext highlighter-rouge">forward-bar</code> will have 0% width and colored, while the <code class="language-plaintext highlighter-rouge">reverse-bar</code> will have 100% width
but not colored:</p>

<figure class="highlight">
  <pre><code class="language-css" data-lang="css"><span class="nc">.progress-bar</span> <span class="p">{</span>
  <span class="nl">display</span><span class="p">:</span> <span class="n">flex</span><span class="p">;</span>
  <span class="nl">width</span><span class="p">:</span> <span class="m">400px</span><span class="p">;</span>
  <span class="nl">background-color</span><span class="p">:</span> <span class="m">#f4e3d7</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.bar</span> <span class="p">{</span>
  <span class="nl">height</span><span class="p">:</span> <span class="m">10px</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.forward-bar</span> <span class="p">{</span>
  <span class="nl">background-color</span><span class="p">:</span> <span class="m">#502d16</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.reverse-bar</span> <span class="p">{</span>
  <span class="nl">background-color</span><span class="p">:</span> <span class="m">#ffffff</span><span class="p">;</span>
<span class="p">}</span></code></pre>
</figure>

<p>Then, when the <code class="language-plaintext highlighter-rouge">forward-bar</code> grows to 100% width, I append the <code class="language-plaintext highlighter-rouge">.reverse</code> class to the <code class="language-plaintext highlighter-rouge">progress-bar</code> container, so
that I can use it to style the <code class="language-plaintext highlighter-rouge">forward-bar</code> and <code class="language-plaintext highlighter-rouge">reverse-bar</code> in reverse colors:</p>

<figure class="highlight">
  <pre><code class="language-css" data-lang="css"><span class="nc">.progress-bar.reverse</span> <span class="nc">.forward-bar</span>  <span class="p">{</span>
  <span class="nl">background-color</span><span class="p">:</span> <span class="m">#ffffff</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.progress-bar.reverse</span> <span class="nc">.reverse-bar</span> <span class="p">{</span>
  <span class="nl">background-color</span><span class="p">:</span> <span class="m">#502d16</span><span class="p">;</span>
<span class="p">}</span></code></pre>
</figure>

<p>In order to determine the current direction, I created a variable named <code class="language-plaintext highlighter-rouge">direction</code> and initialised it to <code class="language-plaintext highlighter-rouge">forward</code>.
We could also use a boolean <code class="language-plaintext highlighter-rouge">forward</code> and set to <code class="language-plaintext highlighter-rouge">true</code>, but I prefer to use string for clarity here.</p>

<figure class="highlight">
  <pre><code class="language-js" data-lang="js"><span class="kd">let</span> <span class="nx">direction</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">forward</span><span class="dl">'</span></code></pre>
</figure>

<p>Then I need to know what’s the current width of the bars, so I created a function for that:</p>

<figure class="highlight">
  <pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nf">getWidth</span><span class="p">(</span><span class="nx">bar</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nf">parseInt</span><span class="p">(</span><span class="nx">bar</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">width</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="dl">'</span><span class="s1">%</span><span class="dl">'</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
<span class="p">}</span></code></pre>
</figure>

<p>Once I know the width, I can grow or shrink the bar by adding steps to the width:</p>

<figure class="highlight">
  <pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nf">step</span><span class="p">(</span><span class="nx">bar</span><span class="p">,</span> <span class="nx">direction</span><span class="p">,</span> <span class="nx">current</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">direction</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">forward</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">bar</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="p">[(</span><span class="nx">current</span> <span class="o">+</span> <span class="mi">5</span><span class="p">).</span><span class="nf">toString</span><span class="p">(),</span> <span class="dl">'</span><span class="s1">%</span><span class="dl">'</span><span class="p">].</span><span class="nf">join</span><span class="p">(</span><span class="dl">''</span><span class="p">)</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">bar</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="p">[(</span><span class="nx">current</span> <span class="o">-</span> <span class="mi">5</span><span class="p">).</span><span class="nf">toString</span><span class="p">(),</span> <span class="dl">'</span><span class="s1">%</span><span class="dl">'</span><span class="p">].</span><span class="nf">join</span><span class="p">(</span><span class="dl">''</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre>
</figure>

<p>When I step forward, I grow the width of the <code class="language-plaintext highlighter-rouge">forward-bar</code> while shrinking the width of the <code class="language-plaintext highlighter-rouge">reverse-bar</code>. In the other
direction, I reverse the action on the bars accordingly:</p>

<figure class="highlight">
  <pre><code class="language-js" data-lang="js"><span class="kd">const</span> <span class="nx">forwardBar</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">forward-bar</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">reverseBar</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">reverse-bar</span><span class="dl">'</span><span class="p">)</span>

<span class="kd">function</span> <span class="nf">stepForward</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">forwardWidth</span> <span class="o">=</span> <span class="nf">getWidth</span><span class="p">(</span><span class="nx">forwardBar</span><span class="p">)</span>
  <span class="kd">const</span> <span class="nx">reverseWidth</span> <span class="o">=</span> <span class="nf">getWidth</span><span class="p">(</span><span class="nx">reverseBar</span><span class="p">)</span>

  <span class="nf">step</span><span class="p">(</span><span class="nx">forwardBar</span><span class="p">,</span> <span class="dl">'</span><span class="s1">forward</span><span class="dl">'</span><span class="p">,</span> <span class="nx">forwardWidth</span><span class="p">)</span>
  <span class="nf">step</span><span class="p">(</span><span class="nx">reverseBar</span><span class="p">,</span> <span class="dl">'</span><span class="s1">reverse</span><span class="dl">'</span><span class="p">,</span> <span class="nx">reverseWidth</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">stepBackward</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">forwardWidth</span> <span class="o">=</span> <span class="nf">getWidth</span><span class="p">(</span><span class="nx">forwardBar</span><span class="p">)</span>
  <span class="kd">const</span> <span class="nx">reverseWidth</span> <span class="o">=</span> <span class="nf">getWidth</span><span class="p">(</span><span class="nx">reverseBar</span><span class="p">)</span>

  <span class="nf">step</span><span class="p">(</span><span class="nx">forwardBar</span><span class="p">,</span> <span class="dl">'</span><span class="s1">reverse</span><span class="dl">'</span><span class="p">,</span> <span class="nx">forwardWidth</span><span class="p">)</span>
  <span class="nf">step</span><span class="p">(</span><span class="nx">reverseBar</span><span class="p">,</span> <span class="dl">'</span><span class="s1">forward</span><span class="dl">'</span><span class="p">,</span> <span class="nx">reverseWidth</span><span class="p">)</span>
<span class="p">}</span></code></pre>
</figure>

<p>If the bar grows to the full 100% width, I will need to change the direction. This is also where I add the <code class="language-plaintext highlighter-rouge">.reverse</code>
class to the <code class="language-plaintext highlighter-rouge">progress-bar</code> so that it will update the background color of individual bars:</p>

<figure class="highlight">
  <pre><code class="language-js" data-lang="js"><span class="kd">const</span> <span class="nx">progressBar</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">progress-bar</span><span class="dl">'</span><span class="p">)</span>

<span class="kd">function</span> <span class="nf">changeDirection</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">direction</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">forward</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">direction</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">reverse</span><span class="dl">'</span>
    <span class="nx">progressBar</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="dl">'</span><span class="s1">reverse</span><span class="dl">'</span><span class="p">)</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">direction</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">forward</span><span class="dl">'</span>
    <span class="nx">progressBar</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nf">remove</span><span class="p">(</span><span class="dl">'</span><span class="s1">reverse</span><span class="dl">'</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre>
</figure>

<p>Now we can put it all together in animation using the <code class="language-plaintext highlighter-rouge">setInterval</code> function, so that it will grow/shrink the bar
every 10ms, creating the effect that it is moving:</p>

<figure class="highlight">
  <pre><code class="language-js" data-lang="js"><span class="kd">const</span> <span class="nx">intervalId</span> <span class="o">=</span> <span class="nf">setInterval</span><span class="p">(</span><span class="nx">animate</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

<span class="kd">function</span> <span class="nf">animate</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">forwardWidth</span> <span class="o">=</span> <span class="nf">getWidth</span><span class="p">(</span><span class="nx">forwardBar</span><span class="p">)</span>
  <span class="kd">const</span> <span class="nx">reverseWidth</span> <span class="o">=</span> <span class="nf">getWidth</span><span class="p">(</span><span class="nx">reverseBar</span><span class="p">)</span>

  <span class="k">if </span><span class="p">(</span><span class="nx">direction</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">forward</span><span class="dl">'</span> <span class="o">&amp;&amp;</span> <span class="nx">forwardWidth</span> <span class="o">===</span> <span class="mi">100</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">changeDirection</span><span class="p">()</span>
    <span class="nf">stepForward</span><span class="p">()</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if </span><span class="p">(</span><span class="nx">direction</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">reverse</span><span class="dl">'</span> <span class="o">&amp;&amp;</span> <span class="nx">reverseWidth</span> <span class="o">===</span> <span class="mi">100</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">changeDirection</span><span class="p">()</span>
    <span class="nf">stepBackward</span><span class="p">()</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if </span><span class="p">(</span><span class="nx">direction</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">forward</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">stepForward</span><span class="p">()</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if </span><span class="p">(</span><span class="nx">direction</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">reverse</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">stepBackward</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre>
</figure>

<p>That’s it! Hope this has been useful.</p>

<script>
let direction = 'forward'

const progressBar = document.getElementById('progress-bar')
const forwardBar = document.getElementById('forward-bar')
const reverseBar = document.getElementById('reverse-bar')

const intervalId = setInterval(animate, 10)

function getWidth(bar) {
  return parseInt(bar.style.width.split('%')[0])
}

function step(bar, direction, current) {
  if (direction === 'forward') {
    bar.style.width = [(current + 5).toString(), '%'].join('')
  } else {
    bar.style.width = [(current - 5).toString(), '%'].join('')
  }
}

function changeDirection() {
  if (direction === 'forward') {
    direction = 'reverse'
    progressBar.classList.add('reverse')
  } else {
    direction = 'forward'
    progressBar.classList.remove('reverse')
  }
}

function stepForward() {
  const forwardWidth = getWidth(forwardBar)
  const reverseWidth = getWidth(reverseBar)

  step(forwardBar, 'forward', forwardWidth)
  step(reverseBar, 'reverse', reverseWidth)
}

function stepBackward() {
  const forwardWidth = getWidth(forwardBar)
  const reverseWidth = getWidth(reverseBar)

  step(forwardBar, 'reverse', forwardWidth)
  step(reverseBar, 'forward', reverseWidth)
}

function animate() {
  const forwardWidth = getWidth(forwardBar)
  const reverseWidth = getWidth(reverseBar)

  if (direction === 'forward' && forwardWidth === 100) {
    changeDirection()
    stepForward()
  } else if (direction === 'reverse' && reverseWidth === 100) {
    changeDirection()
    stepBackward()
  } else if (direction === 'forward') {
    stepForward()
  } else if (direction === 'reverse') {
    stepBackward()
  }
}

function stopBar() {
  clearInterval(intervalId)
}
</script>

<style>
.progress-bar {
  display: flex;
  width: 400px;
  background-color: var(--secondary-background-color);
}

.bar {
  height: 10px;
}

.forward-bar {
  background-color: var(--main-text-color);
}

.progress-bar.reverse .forward-bar  {
  background-color: var(--main-background-color);
}

.reverse-bar {
  background-color: var(--main-background-color);
}

.progress-bar.reverse .reverse-bar {
  background-color: var(--main-text-color);
}
</style>


      </div>
      <div class="btn"><a id="bidirection_progress_bar-btn" href="#" onclick="toggleCollapse(this)">Expand</a></div>
    </div>
  
    <div class="item" id="unsigned_electron_app_apple_silicon-section">
      <div class="title">
        <span>Cannot open unsigned Electron App on Apple Silicon Mac</span>
        <small>May 01, 2023 <em>by gohkhoonhiang</em></small>
      </div>
      <div class="preview" id="unsigned_electron_app_apple_silicon-preview">
        <p><p>I released the installer for MacOS (arm64) distribution for the SG SSB Tracker app on Github Releases, and downloaded
it to install the app, MacOS told me it’s damaged and should move it to the bin.</p>
</p>
      </div>
      <div class="full-content" id="unsigned_electron_app_apple_silicon-content" hidden>
        <p>I released the installer for MacOS (arm64) distribution for the SG SSB Tracker app on Github Releases, and downloaded
it to install the app, MacOS told me it’s damaged and should move it to the bin.</p>

<p>I tried installing the app locally from the installer packaged by Electron Forge, the app can open just fine.</p>

<p>After some search, I stumbled upon this
<a href="https://github.com/marktext/marktext/issues/2983" target="_blank">thread</a> on MarkText Github Issues. It
seems like the issue is due to the app not being code signed, and so Apple blocked it from being opened? The only
workaround is to remove the app from “Quarantine”, by running this command:</p>

<figure class="highlight">
  <pre><code class="language-console" data-lang="console"><span class="go">xattr -r -d com.apple.quarantine /Applications/SG\ SSB\ Tracker.app</span></code></pre>
</figure>

<p>A quick look at the <code class="language-plaintext highlighter-rouge">xattr</code> <a href="https://ss64.com/osx/xattr.html" target="_blank">man page</a> explains what the
command is actually doing:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">xattr</code> is the command used to display or manipulate extended attributes of a file.</li>
  <li><code class="language-plaintext highlighter-rouge">-r</code> applies the command recursively to the file.</li>
  <li><code class="language-plaintext highlighter-rouge">-d</code> deletes a given attribute of the file.</li>
  <li><code class="language-plaintext highlighter-rouge">com.apple.quarantine</code> is the attribute that puts the app in “Quarantine”.</li>
</ul>

<p>On the other hand, if I build the app for x64 distribution, I can open the app on a arm64 Mac, this time it will still
try to block me, but at least it allows me to “Open Anyway”.</p>

<p>Does that mean I have to pay USD99/year just to be able to sign a <em><strong>free</strong></em> app for distribution
to Apple Silicon Mac users?</p>

      </div>
      <div class="btn"><a id="unsigned_electron_app_apple_silicon-btn" href="#" onclick="toggleCollapse(this)">Expand</a></div>
    </div>
  
    <div class="item" id="centered-even-grid-layout-section">
      <div class="title">
        <span>How to create the same column width grid layout in the same page</span>
        <small>Apr 20, 2023 <em>by gohkhoonhiang</em></small>
      </div>
      <div class="preview" id="centered-even-grid-layout-preview">
        <p><p>So the problem I encountered was this: I have a page that have 2 separate grid sections. Each section can have its own
variable number of items. I want to display the items in a 3-column grid layout.</p>
</p>
      </div>
      <div class="full-content" id="centered-even-grid-layout-content" hidden>
        <p>So the problem I encountered was this: I have a page that have 2 separate grid sections. Each section can have its own
variable number of items. I want to display the items in a 3-column grid layout.</p>

<p>My first solution was taken from the web, and it’s something along this line.</p>

<figure class="highlight">
  <pre><code class="language-css" data-lang="css"><span class="nc">.container</span> <span class="p">{</span>
  <span class="nl">display</span><span class="p">:</span> <span class="n">grid</span><span class="p">;</span>
  <span class="py">grid-template-columns</span><span class="p">:</span> <span class="nb">auto</span> <span class="nb">auto</span> <span class="nb">auto</span><span class="p">;</span>
  <span class="nl">justify-content</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>
  <span class="nl">align-items</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>
<span class="p">}</span></code></pre>
</figure>

<p>But it turned out like this when I have 2 items in the second section:</p>

<div class="example-container example-1">
  <p class="example-heading">Section 1</p>
  <div class="example-grid">
    <div class="example-item">
      <p><img src="/assets/images/projects/placeholder.png" /></p>
    </div>
    <div class="example-item">
      <p><img src="/assets/images/projects/placeholder.png" /></p>
    </div>
    <div class="example-item">
      <p><img src="/assets/images/projects/placeholder.png" /></p>
    </div>
    <div class="example-item">
      <p><img src="/assets/images/projects/placeholder.png" /></p>
    </div>
  </div>

  <p class="example-heading">Section 2</p>
  <div class="example-grid">
    <div class="example-item">
      <p><img src="/assets/images/projects/placeholder.png" /></p>
    </div>
    <div class="example-item">
      <p><img src="/assets/images/projects/placeholder.png" /></p>
    </div>
  </div>
</div>

<p>Due to the <code class="language-plaintext highlighter-rouge">auto</code> value for <code class="language-plaintext highlighter-rouge">grid-template-columns</code>, when there’re only 2 items, it will stretch and fit the width of
the container.</p>

<p>So I thought I had to use math to calculate the width of each grid column, in order for the 2-item grid to only take
up exactly 2 column-width.</p>

<figure class="highlight">
  <pre><code class="language-css" data-lang="css"><span class="o">//</span> <span class="err">8</span><span class="nt">rem</span> <span class="o">=</span> <span class="err">1</span><span class="nt">rem</span> <span class="nt">on</span> <span class="nt">each</span> <span class="nt">side</span> <span class="nt">of</span> <span class="nt">the</span> <span class="nt">grid</span> <span class="nt">for</span> <span class="err">3</span> <span class="nt">grids</span> <span class="o">+</span> <span class="nt">container</span> <span class="nt">padding</span> <span class="nt">of</span> <span class="err">1</span><span class="nt">rem</span> <span class="nt">on</span> <span class="nt">each</span> <span class="nt">side</span>
<span class="nc">.container</span> <span class="p">{</span>
  <span class="nl">display</span><span class="p">:</span> <span class="n">grid</span><span class="p">;</span>
  <span class="py">grid-template-columns</span><span class="p">:</span> <span class="n">calc</span><span class="p">((</span><span class="m">100vw</span> <span class="n">-</span> <span class="m">8rem</span><span class="p">)</span> <span class="p">/</span> <span class="m">3</span><span class="p">)</span> <span class="n">calc</span><span class="p">((</span><span class="m">100vw</span> <span class="n">-</span> <span class="m">8rem</span><span class="p">)</span> <span class="p">/</span> <span class="m">3</span><span class="p">)</span> <span class="n">calc</span><span class="p">((</span><span class="m">100vw</span> <span class="n">-</span> <span class="m">8rem</span><span class="p">)</span> <span class="p">/</span> <span class="m">3</span><span class="p">);</span>
  <span class="nl">justify-content</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>
  <span class="nl">align-items</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>
<span class="p">}</span></code></pre>
</figure>

<p>It’s what I wanted, but there’s too much math going on.</p>

<div class="example-container example-2">
  <p class="example-heading">Section 1</p>
  <div class="example-grid">
    <div class="example-item">
      <p><img src="/assets/images/projects/placeholder.png" /></p>
    </div>
    <div class="example-item">
      <p><img src="/assets/images/projects/placeholder.png" /></p>
    </div>
    <div class="example-item">
      <p><img src="/assets/images/projects/placeholder.png" /></p>
    </div>
    <div class="example-item">
      <p><img src="/assets/images/projects/placeholder.png" /></p>
    </div>
  </div>

  <p class="example-heading">Section 2</p>
  <div class="example-grid">
    <div class="example-item">
      <p><img src="/assets/images/projects/placeholder.png" /></p>
    </div>
    <div class="example-item">
      <p><img src="/assets/images/projects/placeholder.png" /></p>
    </div>
  </div>
</div>

<p>Okay, then I read about this thing called
<a href="https://css-tricks.com/snippets/css/complete-guide-grid/#aa-special-units-functions" target="_blank">fractional units (fr)</a>,
so I thought what about I change to this:</p>

<figure class="highlight">
  <pre><code class="language-css" data-lang="css"><span class="nc">.container</span> <span class="p">{</span>
  <span class="nl">display</span><span class="p">:</span> <span class="n">grid</span><span class="p">;</span>
  <span class="py">grid-template-columns</span><span class="p">:</span> <span class="m">1</span><span class="n">fr</span> <span class="m">1</span><span class="n">fr</span> <span class="m">1</span><span class="n">fr</span><span class="p">;</span>
  <span class="nl">justify-content</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>
  <span class="nl">align-items</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>
<span class="p">}</span></code></pre>
</figure>

<p>Now this looks exactly like the previous one, without the complex calculation.</p>

<div class="example-container example-3">
  <p class="example-heading">Section 1</p>
  <div class="example-grid">
    <div class="example-item">
      <p><img src="/assets/images/projects/placeholder.png" /></p>
    </div>
    <div class="example-item">
      <p><img src="/assets/images/projects/placeholder.png" /></p>
    </div>
    <div class="example-item">
      <p><img src="/assets/images/projects/placeholder.png" /></p>
    </div>
    <div class="example-item">
      <p><img src="/assets/images/projects/placeholder.png" /></p>
    </div>
  </div>

  <p class="example-heading">Section 2</p>
  <div class="example-grid">
    <div class="example-item">
      <p><img src="/assets/images/projects/placeholder.png" /></p>
    </div>
    <div class="example-item">
      <p><img src="/assets/images/projects/placeholder.png" /></p>
    </div>
  </div>
</div>

<p>I drank a few cups of coffee to figure this out so you don’t have to. Enjoy this mid-day shot.</p>

<style>
.example-container {
  margin: 1rem;
  width: 25vw;
  border: 1px var(--lighten-text-4-color) solid;
}

.example-heading {
  margin: 0 1rem;
  padding: 0 1rem;
}

.example-grid {
  display: grid;
  justify-content: center;
  align-items: center;
  border: 1px var(--secondary-background-color) solid;
  margin: 0 1rem;
  padding: 0 1rem;
}

.example-item {
  margin: 0 1rem;
}

.example-grid img {
  width: 100%;
}

.example-1 .example-grid {
  grid-template-columns: repeat(3, auto);
}

.example-2 .example-grid {
  grid-template-columns: repeat(3, calc((25vw - 4rem) / 3));
}

.example-3 .example-grid {
  grid-template-columns: repeat(3, 1fr);
}

.example-4 .example-grid {
  grid-template-columns: repeat(3, 1fr);
  padding: 0 !important;
}

@media screen and (max-width: 1024px) {
  .example-container {
    margin: 4px;
    width: 60vw;
  }

  .example-item {
    margin: 0 4px;
  }

  .example-2 .example-grid {
    grid-template-columns: repeat(3, calc((60vw - 4rem) / 3));
  }
}
</style>


      </div>
      <div class="btn"><a id="centered-even-grid-layout-btn" href="#" onclick="toggleCollapse(this)">Expand</a></div>
    </div>
  
    <div class="item" id="gh_as_data_server-section">
      <div class="title">
        <span>Using Github as a pseudo-JSON API server</span>
        <small>Apr 11, 2023 <em>by gohkhoonhiang</em></small>
      </div>
      <div class="preview" id="gh_as_data_server-preview">
        <p><p>While building the
<a href="https://www.coffeebrewapps.com/sg_bank_int_compare/" target="_blank">SG Bank Interests Compare App</a>, I
faced a problem: “How can I serve JSON data API while hosting the app on Github Pages?”</p>
</p>
      </div>
      <div class="full-content" id="gh_as_data_server-content" hidden>
        <p>While building the
<a href="https://www.coffeebrewapps.com/sg_bank_int_compare/" target="_blank">SG Bank Interests Compare App</a>, I
faced a problem: “How can I serve JSON data API while hosting the app on Github Pages?”</p>

<p>I forgot how I stumbled upon the idea, but eventually I decided to make use of Github itself as a pseudo-API server.
Here’s how I executed it for my app.</p>

<p>But first, let’s talk a little bit about why Github is actually a pretty good candidate:</p>

<ul>
  <li>Versioning is built into it, thanks to git commits.</li>
  <li>Github can serve raw files under the <code class="language-plaintext highlighter-rouge">https://raw.githubusercontent.com/</code> domain.</li>
</ul>

<p>It’s screaming at me that: “Hey, I can actually be a pretty good versioned data API server!”</p>

<p>So I separated my app into 2 repositories:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">sg_bank_int_compare-source</code>: This will host the source code, data files and build scripts.</li>
  <li><code class="language-plaintext highlighter-rouge">sg_bank_int_compare</code>: This will host the built page that can be served by Github Pages.</li>
</ul>

<p>For the <code class="language-plaintext highlighter-rouge">sg_bank_int_compare-source</code> repo, I have both the page assets and the data JSON files.</p>

<p>Note: Omitted some files for clarity.</p>

<figure class="highlight">
  <pre><code class="language-console" data-lang="console"><span class="go">src
├── App.vue
├── components
│   └── CalculatorForm.vue
├── data
│   ├── cimb_fast_saver.json
│   └── uob_one.json
├── main.js
└── scripts
    └── calculator.js</span></code></pre>
</figure>

<p>Then in the <code class="language-plaintext highlighter-rouge">sg_bank_int_compare</code> repo, I further separate it into 2 branches:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">main</code>: This is where the app index page and assets will be served.</li>
  <li><code class="language-plaintext highlighter-rouge">data</code>: This only contains the JSON data files.</li>
</ul>

<p>Whenever I make changes to the source, I will run a script that will checkout the <code class="language-plaintext highlighter-rouge">data</code> branch in
<code class="language-plaintext highlighter-rouge">sg_bank_int_compare</code>, then copy the <code class="language-plaintext highlighter-rouge">data/*.json</code> files into the <code class="language-plaintext highlighter-rouge">data</code> directory. If there are changes to the data,
it will create a new commit.</p>

<p>The script then reads this commit hash, and compare it with the current <code class="language-plaintext highlighter-rouge">LATEST_VERSION</code> in the source file. If it’s
different, then it will replace it with the new commit hash.</p>

<p>And finally, the script will build the page and checkout the <code class="language-plaintext highlighter-rouge">main</code> branch in <code class="language-plaintext highlighter-rouge">sg_bank_int_compare</code> to create a commit.</p>

<p>Now when I push the <code class="language-plaintext highlighter-rouge">data</code> branch to Github, I will be able to see the raw JSON files under
<code class="language-plaintext highlighter-rouge">https://raw.githubusercontent.com/coffeebrewapps/sg_bank_int_compare/${LATEST_VERSION}/data/</code>. And then I push the
<code class="language-plaintext highlighter-rouge">main</code> branch to Github, and it will be able to request for the JSON data from the same URL.</p>

<figure class="highlight">
  <pre><code class="language-js" data-lang="js"><span class="c1">// source will be something like:</span>
<span class="c1">// https://raw.githubusercontent.com/coffeebrewapps/sg_bank_int_compare/366b5c954e2c5155b9c9f9c728a9b428956917e2/data/cimb_fast_saver.json</span>
<span class="nx">axios</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="nx">source</span><span class="p">)</span>
  <span class="p">.</span><span class="nf">then</span><span class="p">(</span><span class="nf">function </span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// parse the response and use the data for interest calculation</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nf">function </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">});</span></code></pre>
</figure>

<p>So, after reading so far, you might be thinking: “Why not just hardcode the data in a variable in JS and read directly?”</p>

<p>Yes, I did think about that question too, but I wanted to have a separation of “client” and “server”, so that in the
future, if I do have the resource to host the data on an actual server, I don’t have to change a lot of my client code,
and just have to update the API URLs.</p>

<p>I hope this little trick is useful for you too if you intend to build an app hosted on Github Pages that requires a
data API but don’t have an actual server to serve it.</p>

      </div>
      <div class="btn"><a id="gh_as_data_server-btn" href="#" onclick="toggleCollapse(this)">Expand</a></div>
    </div>
  
</div>


<div class="pagination">
  <ul class="pager">
    
    
    <li class="next">
      <a href="/shots/2/index.html">Older Shots <i class="fa-solid fa-arrow-right"></i></a>
    </li>
    
  </ul>
</div>



    </div>
    <a class="back-to-top" href="#">
        <i class="fa-solid fa-angle-up"></i>
    </a>
    <footer class="site-footer">
      <div class="copyright">
        <span>Coffee Brew Apps © 2024</span>
      </div>
      <div class="socials">
        <a href="https://github.com/coffeebrewapps" target="_blank"><i class="fa-brands fa-github"></i></a>
        <a href="https://www.linkedin.com/company/coffeebrewapps/" target="_blank"><i class="fa-brands fa-linkedin"></i></a>
        <a href="mailto:hi@coffeebrewapps.com"><i class="fa-solid fa-envelope"></i></a>
      </div>
      <div class="powered-by">
        <div class="link">Powered by <a href="https://jekyllrb.com" target="_blank">Jekyll</a></div>
        <div class="divider">|</div>
        <div class="link">Theme by <a href="#">Coffee Brew Apps</a></div>
        <div class="divider">|</div>
        <div class="link">Hosted on <a href="https://github.com" target="_blank">Github Pages</a></div>
      </div>
    </footer>
  </body>
</html>
