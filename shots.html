<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link rel="stylesheet" href="/assets/css/styles.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <title>Shots</title>
  </head>
  <body>
    <script src="/assets/js/main.js"></script>
    <nav id="top-nav" class="top-nav">
  
    <a href="/" >
      Home
    </a>
  
    <a href="/about.html" >
      About
    </a>
  
    <a href="/articles.html" >
      Articles
    </a>
  
    <a href="/projects.html" >
      Projects
    </a>
  
    <a href="/shots.html" class="current">
      Shots
    </a>
  
    <a href="/archives.html" >
      Archives
    </a>
  
  <a href="javascript:void(0);" class="icon" onclick="toggleMenu()">
    <i class="fa-solid fa-bars"></i>
  </a>
</nav>

    <div class="container">
      <h1>Shots</h1>
<p>Mid-day shots to boost your energy.</p>
<div class="collapsible">
  
    <div class="item" id="gh_as_data_server-section">
      <div class="title">
        <span>Using Github as a pseudo-JSON API server</span>
        <small>Apr 11, 2023 <em>by gohkhoonhiang</em></small>
      </div>
      <div class="preview" id="gh_as_data_server-preview">
        <p><p>While building the
<a href="https://www.coffeebrewapps.com/sg_bank_int_compare/" target="_blank">SG Bank Interests Compare App</a>, I
faced a problem: “How can I serve JSON data API while hosting the app on Github Pages?”</p>
</p>
      </div>
      <div class="full-content" id="gh_as_data_server-content" hidden>
        <p>While building the
<a href="https://www.coffeebrewapps.com/sg_bank_int_compare/" target="_blank">SG Bank Interests Compare App</a>, I
faced a problem: “How can I serve JSON data API while hosting the app on Github Pages?”</p>

<p>I forgot how I stumbled upon the idea, but eventually I decided to make use of Github itself as a pseudo-API server.
Here’s how I executed it for my app.</p>

<p>But first, let’s talk a little bit about why Github is actually a pretty good candidate:</p>

<ul>
  <li>Versioning is built into it, thanks to git commits.</li>
  <li>Github can serve raw files under the <code class="language-plaintext highlighter-rouge">https://raw.githubusercontent.com/</code> domain.</li>
</ul>

<p>It’s screaming at me that: “Hey, I can actually be a pretty good versioned data API server!”</p>

<p>So I separated my app into 2 repositories:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">sg_bank_int_compare-source</code>: This will host the source code, data files and build scripts.</li>
  <li><code class="language-plaintext highlighter-rouge">sg_bank_int_compare</code>: This will host the built page that can be served by Github Pages.</li>
</ul>

<p>For the <code class="language-plaintext highlighter-rouge">sg_bank_int_compare-source</code> repo, I have both the page assets and the data JSON files.</p>

<p>Note: Omitted some files for clarity.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>src
├── App.vue
├── components
│   └── CalculatorForm.vue
├── data
│   ├── cimb_fast_saver.json
│   └── uob_one.json
├── main.js
└── scripts
    └── calculator.js
</code></pre></div></div>

<p>Then in the <code class="language-plaintext highlighter-rouge">sg_bank_int_compare</code> repo, I further separate it into 2 branches:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">main</code>: This is where the app index page and assets will be served.</li>
  <li><code class="language-plaintext highlighter-rouge">data</code>: This only contains the JSON data files.</li>
</ul>

<p>Whenever I make changes to the source, I will run a script that will checkout the <code class="language-plaintext highlighter-rouge">data</code> branch in
<code class="language-plaintext highlighter-rouge">sg_bank_int_compare</code>, then copy the <code class="language-plaintext highlighter-rouge">data/*.json</code> files into the <code class="language-plaintext highlighter-rouge">data</code> directory. If there are changes to the data,
it will create a new commit.</p>

<p>The script then reads this commit hash, and compare it with the current <code class="language-plaintext highlighter-rouge">LATEST_VERSION</code> in the source file. If it’s
different, then it will replace it with the new commit hash.</p>

<p>And finally, the script will build the page and checkout the <code class="language-plaintext highlighter-rouge">main</code> branch in <code class="language-plaintext highlighter-rouge">sg_bank_int_compare</code> to create a commit.</p>

<p>Now when I push the <code class="language-plaintext highlighter-rouge">data</code> branch to Github, I will be able to see the raw JSON files under
<code class="language-plaintext highlighter-rouge">https://raw.githubusercontent.com/coffeebrewapps/sg_bank_int_compare/${LATEST_VERSION}/data/</code>. And then I push the
<code class="language-plaintext highlighter-rouge">main</code> branch to Github, and it will be able to request for the JSON data from the same URL.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// source will be something like:</span>
<span class="c1">// https://raw.githubusercontent.com/coffeebrewapps/sg_bank_int_compare/366b5c954e2c5155b9c9f9c728a9b428956917e2/data/cimb_fast_saver.json</span>
<span class="nx">axios</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="nx">source</span><span class="p">)</span>
  <span class="p">.</span><span class="nf">then</span><span class="p">(</span><span class="nf">function </span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// parse the response and use the data for interest calculation</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nf">catch</span><span class="p">(</span><span class="nf">function </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">});</span>
</code></pre></div></div>

<p>So, after reading so far, you might be thinking: “Why not just hardcode the data in a variable in JS and read directly?”</p>

<p>Yes, I did think about that question too, but I wanted to have a separation of “client” and “server”, so that in the
future, if I do have the resource to host the data on an actual server, I don’t have to change a lot of my client code,
and just have to update the API URLs.</p>

<p>I hope this little trick is useful for you too if you intend to build an app hosted on Github Pages that requires a
data API but don’t have an actual server to serve it.</p>

      </div>
      <div class="btn"><a id="gh_as_data_server-btn" href="#" onclick="toggleCollapse(this)">Expand</a></div>
    </div>
  
    <div class="item" id="solving_rubocop_mystery-section">
      <div class="title">
        <span>Solving the Rubocop mystery</span>
        <small>Apr 07, 2023 <em>by gohkhoonhiang</em></small>
      </div>
      <div class="preview" id="solving_rubocop_mystery-preview">
        <p><p>So I <a href="/shots.html#rubocop_dep_not_found-section" target="_blank">wrote about</a>
the error I got from running Rubocop in Github Workflow, and I was determined to find out the root of the problem.</p>
</p>
      </div>
      <div class="full-content" id="solving_rubocop_mystery-content" hidden>
        <p>So I <a href="/shots.html#rubocop_dep_not_found-section" target="_blank">wrote about</a>
the error I got from running Rubocop in Github Workflow, and I was determined to find out the root of the problem.</p>

<p>With some digging around the
<a href="https://docs.rubocop.org/rubocop/configuration.html#includingexcluding-files" target="_blank">documentation</a>
and following a <a href="https://github.com/rubocop/rubocop/pull/5882" target="_blank">thread of discussions</a>, I
figured some what the root of the problem and solved it. So a few things happened.</p>

<p>I quote from the documentation:</p>

<blockquote class="quote">
  <p>Remember that your configuration files override RuboCops’s defaults. <em>…omitted…</em> This behavior of Include
(overriding default.yml) was introduced in 0.56.0 via #5882. This change allows people to include/exclude precisely
what they need to, without the defaults getting in the way.</p>
</blockquote>

<p>It is odd, that even though I had explicitly defined <code class="language-plaintext highlighter-rouge">Include</code> option for only <code class="language-plaintext highlighter-rouge">lib/**/*.rb</code> and <code class="language-plaintext highlighter-rouge">spec/**/*.rb</code>,
Rubocop still attempted to look outside of these folders.</p>

<p>So let’s look at the <code class="language-plaintext highlighter-rouge">Exclude</code> option in my own <code class="language-plaintext highlighter-rouge">.rubocop.yml</code>. Here, I explicitly only specified files under
<code class="language-plaintext highlighter-rouge">spec/**/*.rb</code> that I wanted to exclude. I guess here’s where things went wrong.</p>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">AllCops</span><span class="pi">:</span>
  <span class="na">Exclude</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">spec/fixtures/**/*</span>
    <span class="pi">-</span> <span class="s">spec/scenarios/**/*</span>
    <span class="pi">-</span> <span class="s">spec/spec_helper.rb</span>
</code></pre></div></div>

<p>By default, Rubocop already excludes <code class="language-plaintext highlighter-rouge">vendor/**/*</code>, but as per the documentation above, when the user defines the
<code class="language-plaintext highlighter-rouge">Exclude</code> option, it will completely override all defaults from Rubocop. In a way, it will “undo” the default
exclusion of <code class="language-plaintext highlighter-rouge">vendor/**/*</code>, so even though my <code class="language-plaintext highlighter-rouge">Include</code> option did not specify <code class="language-plaintext highlighter-rouge">vendor/**/*</code>, it will still attempt to
search inside the directory.</p>

<p>In order to still use Rubocop’s defaults, we can go the brute-force way of copying all the <code class="language-plaintext highlighter-rouge">Include</code>/<code class="language-plaintext highlighter-rouge">Exclude</code> options
from Rubocop’s <code class="language-plaintext highlighter-rouge">config/default.yml</code>. But that’s not very friendly, so the other way is to inherit from the defaults
and add additional <code class="language-plaintext highlighter-rouge">Include</code>/<code class="language-plaintext highlighter-rouge">Exclude</code> options.</p>

<p>Luckily I was not the first to encounter such an issue, so I just referenced what other people
<a href="https://github.com/pixta-dev/pixta-rubocop/pull/16/files" target="_blank">did</a> and modified accordingly.
And here’s
<a href="https://github.com/coffeebrewapps/coffeebrew_jekyll_archives/pull/11/commits/8152f3535e483ce4d952234d4341772d34b9d819" target="_blank">the fix</a>
for it.</p>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">inherit_from</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">https://raw.githubusercontent.com/rubocop/rubocop/v1.45.1/config/default.yml</span>

<span class="na">inherit_mode</span><span class="pi">:</span>
  <span class="na">merge</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">Include</span>
    <span class="pi">-</span> <span class="s">Exclude</span>

<span class="na">AllCops</span><span class="pi">:</span>
  <span class="na">Exclude</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">spec/fixtures/**/*</span>
    <span class="pi">-</span> <span class="s">spec/scenarios/**/*</span>
    <span class="pi">-</span> <span class="s">spec/spec_helper.rb</span>
</code></pre></div></div>

<p>Now the build passes on Github Workflow, and I can go sit back and relax and enjoy another shot of expresso.</p>

      </div>
      <div class="btn"><a id="solving_rubocop_mystery-btn" href="#" onclick="toggleCollapse(this)">Expand</a></div>
    </div>
  
    <div class="item" id="rubocop_dep_not_found-section">
      <div class="title">
        <span>Rubocop dependency not found in Github Workflow</span>
        <small>Apr 06, 2023 <em>by gohkhoonhiang</em></small>
      </div>
      <div class="preview" id="rubocop_dep_not_found-preview">
        <p><p>Today, I was trying to setup the Github Workflow for
<a href="https://github.com/coffeebrewapps/coffeebrew_jekyll_archives" target="_blank">
Coffeebrew Jekyll Archives plugin</a> to run test cases and lint the code.</p>
</p>
      </div>
      <div class="full-content" id="rubocop_dep_not_found-content" hidden>
        <p>Today, I was trying to setup the Github Workflow for
<a href="https://github.com/coffeebrewapps/coffeebrew_jekyll_archives" target="_blank">
Coffeebrew Jekyll Archives plugin</a> to run test cases and lint the code.</p>

<p>Here’s the initial setup (excerpts):</p>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">jobs</span><span class="pi">:</span>
  <span class="na">test</span><span class="pi">:</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v2</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Set up Ruby</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">ruby/setup-ruby@v1</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">ruby-version</span><span class="pi">:</span> <span class="s">$</span>
          <span class="na">bundler-cache</span><span class="pi">:</span> <span class="kc">true</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Run tests</span>
        <span class="na">run</span><span class="pi">:</span> <span class="s">bash script/cibuild</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">script/cibuild</code> script basically just does 3 things (excerpts):</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bundle <span class="nb">install
</span>bundle <span class="nb">exec </span>rubocop <span class="nt">-D</span> <span class="nt">-E</span> <span class="nv">$@</span>
bundle <span class="nb">exec </span>rspec <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span>
</code></pre></div></div>

<p>Then I kept running into the error:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>RuboCop 1.45.1
cannot load such file <span class="nt">--</span> rubocop-minitest
/home/runner/work/coffeebrew_jekyll_archives/coffeebrew_jekyll_archives/vendor/bundle/ruby/3.2.0/gems/rubocop-1.45.1/lib/rubocop/feature_loader.rb:46:in <span class="sb">`</span>rescue <span class="k">in </span>rescue <span class="k">in </span>load<span class="s1">'
</span></code></pre></div></div>

<p>In my mind I was like: “Why on earth did <code class="language-plaintext highlighter-rouge">rubocop-minitest</code> get into my project?”. I tried a few Google searches, they
mostly just mention something along the line of “remember to <code class="language-plaintext highlighter-rouge">require: rubocop-minitest</code> in your <code class="language-plaintext highlighter-rouge">.rubocop.yml</code>”.</p>

<p>But why? I didn’t even use <code class="language-plaintext highlighter-rouge">minitest</code> in my project!</p>

<p>Then with some luck, I stumbled upon this
<a href="https://stackoverflow.com/questions/69415433/bundle-exec-rubocop-failling-on-github-actions-but-runs-successfully-locally" target="_blank">
Stack Overflow question</a>. It’s not exactly the same problem, but the response seems promising. So I followed the
advice and updated my <code class="language-plaintext highlighter-rouge">.rubocop.yml</code> to exclude <code class="language-plaintext highlighter-rouge">vendor/**/*</code>.</p>

<p>Lo and behold, my workflow run finally succeeded.
Here’s <a href="https://github.com/coffeebrewapps/coffeebrew_jekyll_archives/commit/4e5e532025748a7eaeac5c9c7cf8560c6ab06f7a" target="_blank">
the fix</a>.</p>

<p>This will not be the end, I will need to figure out why did Rubocop also try to lint the dependencies when I already
specified the <code class="language-plaintext highlighter-rouge">Include</code> option to:</p>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">AllCops</span><span class="pi">:</span>
  <span class="na">Include</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">lib/**/*.rb</span>
    <span class="pi">-</span> <span class="s">spec/**/*.rb</span>
</code></pre></div></div>

<p>This will be another shot/article that I write when I figure it out. Hope this shot gives you a boost for the day.
Stay tuned for more!</p>

      </div>
      <div class="btn"><a id="rubocop_dep_not_found-btn" href="#" onclick="toggleCollapse(this)">Expand</a></div>
    </div>
  
</div>




    </div>
    <a class="back-to-top" href="#">
        <i class="fa-solid fa-angle-up"></i>
    </a>
    <footer class="site-footer">
      <div class="copyright">
        <span>Coffee Brew Apps © 2023</span>
      </div>
      <div class="socials">
        <a href="https://github.com/coffeebrewapps" target="_blank"><i class="fa-brands fa-github"></i></a>
        <a href="https://www.linkedin.com/company/coffeebrewapps/" target="_blank"><i class="fa-brands fa-linkedin"></i></a>
        <a href="mailto:coffeebrewapps+hi@gmail.com"><i class="fa-solid fa-envelope"></i></a>
      </div>
      <div class="powered-by">
        <div class="link">Powered by <a href="https://jekyllrb.com" target="_blank">Jekyll</a></div>
        <div class="divider">|</div>
        <div class="link">Theme by <a href="#">Coffee Brew Apps</a></div>
        <div class="divider">|</div>
        <div class="link">Hosted by <a href="https://github.com" target="_blank">Github Pages</a></div>
      </div>
    </footer>
  </body>
</html>
